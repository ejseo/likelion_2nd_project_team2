<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${post.title} + ' - Travelog'">ê²Œì‹œê¸€ - Travelog</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Serif KR', serif;
            color: #222;
            line-height: 1.8;
            background-color: #fafafa;
        }

        /* Header */
        header {
            background-color: white;
            border-bottom: 1px solid #e8e8e8;
            padding: 20px 40px;
        }

        nav {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            font-weight: 700;
            color: #2D9596;
            text-decoration: none;
            letter-spacing: -0.5px;
        }

        .nav-links {
            display: flex;
            gap: 32px;
            align-items: center;
        }

        .nav-links a {
            color: #444;
            text-decoration: none;
            font-size: 15px;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: #2D9596;
        }

        /* Back Button */
        .back-section {
            max-width: 800px;
            margin: 0 auto;
            padding: 24px 40px 0;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #666;
            text-decoration: none;
            font-size: 15px;
            transition: all 0.3s ease;
            padding: 8px 16px;
            border-radius: 20px;
        }

        .back-btn:hover {
            color: #2D9596;
            background-color: #f0f0f0;
        }

        /* Article Container */
        .article-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 40px 80px;
        }

        /* Article Header */
        .article-header {
            text-align: center;
            margin-bottom: 48px;
        }

        .article-category {
            display: inline-block;
            padding: 6px 16px;
            background-color: #E8F5F5;
            color: #2D9596;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .article-title {
            font-family: 'Playfair Display', serif;
            font-size: 42px;
            font-weight: 700;
            color: #1a1a1a;
            line-height: 1.3;
            margin-bottom: 24px;
            letter-spacing: -0.5px;
        }

        .article-rating {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 18px;
            color: #FFB800;
            margin-bottom: 32px;
        }

        .rating-stars {
            letter-spacing: 2px;
        }

        .rating-score {
            font-weight: 600;
            color: #333;
        }

        /* Article Meta */
        .article-meta {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 24px;
            padding: 24px 0;
            border-top: 1px solid #e8e8e8;
            border-bottom: 1px solid #e8e8e8;
        }

        .author-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .author-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-color: #e8e8e8;
        }

        .author-details {
            text-align: left;
        }

        .author-name {
            font-weight: 600;
            color: #222;
            font-size: 15px;
        }

        .author-stats {
            font-size: 13px;
            color: #999;
        }

        .follow-btn {
            padding: 8px 20px;
            background-color: #2D9596;
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .follow-btn:hover {
            background-color: #267C7D;
            transform: translateY(-1px);
        }

        .follow-btn.following {
            background-color: white;
            color: #2D9596;
            border: 1px solid #2D9596;
        }

        .follow-btn.following:hover {
            background-color: #FFF3F3;
            color: #FF6B6B;
            border-color: #FF6B6B;
        }

        .article-date {
            font-size: 14px;
            color: #999;
        }

        /* Tags */
        .article-tags {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 24px 0;
            flex-wrap: wrap;
        }

        .tag {
            padding: 6px 14px;
            background-color: #f0f0f0;
            color: #666;
            border-radius: 14px;
            font-size: 13px;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .tag:hover {
            background-color: #E8F5F5;
            color: #2D9596;
        }

        /* Featured Image */
        .featured-image {
            width: 100%;
            max-height: 600px;
            object-fit: cover;
            border-radius: 8px;
            margin: 48px 0;
        }

        /* Article Content */
        .article-content {
            font-size: 18px;
            line-height: 2;
            color: #333;
            margin: 48px 0;
        }

        .article-content p {
            margin-bottom: 32px;
        }

        .article-content img {
            width: 100%;
            border-radius: 8px;
            margin: 48px 0;
        }

        /* Action Buttons */
        .article-actions {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin: 48px 0;
            padding: 32px 0;
            border-top: 1px solid #e8e8e8;
            border-bottom: 1px solid #e8e8e8;
        }

        .action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 20px 32px;
            background-color: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            border-color: #2D9596;
            background-color: #f8f9fa;
        }
        
        .action-btn:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        .action-btn.active {
            background-color: #E8F5F5;
            border-color: #2D9596;
            color: #2D9596;
        }

        .action-icon {
            font-size: 24px;
        }

        .action-label {
            font-size: 14px;
            color: #666;
        }

        .action-count {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        /* Edit/Delete Buttons */
        .author-controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 24px 0;
        }

        .btn-edit,
        .btn-delete {
            padding: 10px 24px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            border: none;
        }

        .btn-edit {
            background-color: #FFB800;
            color: white;
        }

        .btn-edit:hover {
            background-color: #E6A600;
            color: white;
        }

        .btn-delete {
            background-color: #FF6B6B;
            color: white;
        }

        .btn-delete:hover {
            background-color: #E85555;
        }

        /* Share Section */
        .share-section {
            text-align: center;
            margin: 48px 0;
        }

        .share-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 16px;
        }

        .share-buttons {
            display: flex;
            justify-content: center;
            gap: 12px;
        }

        .share-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 1px solid #e0e0e0;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
        }

        .share-btn:hover {
            border-color: #2D9596;
            background-color: #E8F5F5;
            transform: translateY(-2px);
        }

        /* Comments Section */
        .comments-section {
            margin-top: 80px;
            padding-top: 48px;
            border-top: 2px solid #e8e8e8;
        }

        .comments-header {
            font-size: 24px;
            font-weight: 700;
            color: #222;
            margin-bottom: 32px;
        }

        .comments-header .count {
            font-size: 18px;
            color: #2D9596;
            font-weight: 600;
        }

        .comment-form {
            margin-bottom: 40px;
        }

        .comment-textarea {
            width: 100%;
            padding: 16px;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            font-size: 15px;
            font-family: 'Noto Serif KR', serif;
            resize: vertical;
            min-height: 120px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .comment-textarea:focus {
            border-color: #2D9596;
        }

        .comment-form-footer {
            display: flex;
            justify-content: flex-end;
            margin-top: 12px;
        }

        .btn-submit-comment {
            padding: 10px 24px;
            background-color: #2D9596;
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-submit-comment:hover {
            background-color: #267C7D;
        }

        .comments-list {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .comment-item {
            padding: 24px;
            background-color: white;
            border-radius: 12px;
            border: 1px solid #e8e8e8;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .comment-author {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .comment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #e8e8e8;
        }

        .comment-author-name {
            font-weight: 600;
            color: #222;
            font-size: 15px;
        }

        .comment-date {
            font-size: 13px;
            color: #999;
        }

        .comment-content {
            font-size: 15px;
            color: #333;
            line-height: 1.7;
        }

        .btn-delete-comment {
            padding: 6px 12px;
            background-color: transparent;
            color: #999;
            border: 1px solid #ddd;
            border-radius: 16px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-delete-comment:hover {
            background-color: #FF6B6B;
            color: white;
            border-color: #FF6B6B;
        }

        /* Footer */
        footer {
            background-color: #1a1a1a;
            color: #999;
            padding: 60px 40px 40px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 60px;
            margin-bottom: 40px;
        }

        .footer-logo {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            font-weight: 700;
            color: #2D9596;
            margin-bottom: 16px;
        }

        .footer-description {
            font-size: 14px;
            line-height: 1.8;
            color: #666;
        }

        .footer-section h4 {
            color: #fff;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 12px;
        }

        .footer-links a {
            color: #999;
            text-decoration: none;
            font-size: 14px;
            transition: color 0.3s ease;
        }

        .footer-links a:hover {
            color: #2D9596;
        }

        .footer-bottom {
            max-width: 1200px;
            margin: 0 auto;
            padding-top: 30px;
            border-top: 1px solid #333;
            text-align: center;
            font-size: 13px;
            color: #666;
        }

        /* Responsive */
        @media (max-width: 768px) {
            nav {
                padding: 16px 20px;
            }

            .logo {
                font-size: 24px;
            }

            .article-container {
                padding: 30px 20px 60px;
            }

            .article-title {
                font-size: 32px;
            }

            .article-content {
                font-size: 16px;
            }

            .article-meta {
                flex-direction: column;
                gap: 16px;
            }

            .article-actions {
                flex-wrap: wrap;
            }

            .footer-content {
                grid-template-columns: 1fr;
                gap: 40px;
            }
        }

        /* Animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .article-container {
            animation: fadeIn 0.6s ease-out;
        }
    </style>
</head>
<body>
<!-- Header -->
<header>
    <nav>
        <a href="/" class="logo">Travelog</a>
        <div class="nav-links">
            <a href="/posts">ì—¬í–‰ ì´ì•¼ê¸°</a>
            <a href="/about">ì†Œê°œ</a>
            <a href="/my-page">ë§ˆì´í˜ì´ì§€</a>
        </div>
    </nav>
</header>

<!-- Back Button -->
<div class="back-section">
    <a th:href="@{/posts}" class="back-btn">
        <span>â†</span>
        <span>ëª©ë¡ìœ¼ë¡œ</span>
    </a>
</div>

<!-- Article Container -->
<article class="article-container">
    <!-- Article Header -->
    <header class="article-header">
        <div th:if="${post.category != null and !post.category.isEmpty()}" class="article-category">
            <span th:switch="${post.category}">
                <span th:case="'beach'">ğŸ–ï¸ í•´ë³€</span>
                <span th:case="'mountain'">ğŸ”ï¸ ì‚°Â·ìì—°</span>
                <span th:case="'city'">ğŸ™ï¸ ë„ì‹œ</span>
                <span th:case="'food'">ğŸ½ï¸ ë§›ì§‘</span>
                <span th:case="'culture'">ğŸ­ ë¬¸í™”</span>
                <span th:case="'activity'">ğŸ¿ ì•¡í‹°ë¹„í‹°</span>
                <span th:case="*" th:text="${post.category}">ê¸°íƒ€</span>
            </span>
        </div>

        <h1 class="article-title" th:text="${post.title}">ì œì£¼ì—ì„œì˜ í•œ ë‹¬, ëŠë¦¬ê²Œ ì‚´ì•„ë³´ê¸°</h1>

        <div th:if="${post.rating != null}" class="article-rating">
            <span class="rating-stars">
                <span th:each="i : ${#numbers.sequence(1, 5)}"
                      th:text="${i <= post.rating} ? 'â˜…' : 'â˜†'">â˜…</span>
            </span>
            <span class="rating-score" th:text="${post.rating} + ' / 5'">4 / 5</span>
        </div>
    </header>

    <!-- Article Meta -->
    <div class="article-meta">
        <div class="author-info">
            <div class="author-avatar"></div>
            <div class="author-details">
                <div class="author-name" th:text="${post.author.username}">ì—¬í–‰ëŸ¬ë²„</div>
                <div class="author-stats">
                    <span>íŒ”ë¡œì‰ <span id="followingCount">0</span></span>
                    <span>Â·</span>
                    <span>íŒ”ë¡œì›Œ <span id="followerCount">0</span></span>
                </div>
            </div>
        </div>

        <div th:if="${#authentication != null and #authentication.name != post.author.username}">
            <button id="followToggleButton"
                    th:class="${followCheck} ? 'follow-btn following' : 'follow-btn'"
                    th:attr="data-following=${followCheck}"
                    th:text="${followCheck} ? 'íŒ”ë¡œì‰' : 'íŒ”ë¡œìš°'">íŒ”ë¡œìš°</button>
        </div>

        <div class="article-date">
            <div th:text="${#temporals.format(post.createdAt, 'yyyyë…„ MMì›” ddì¼')}">2024ë…„ 11ì›” 20ì¼</div>
            <div th:if="${post.updatedAt != post.createdAt}"
                 style="font-size: 12px; color: #bbb;">
                (ìˆ˜ì •: <span th:text="${#temporals.format(post.updatedAt, 'MM.dd')}"></span>)
            </div>
        </div>
    </div>

    <!-- [ìˆ˜ì •] íƒœê·¸ í‘œì‹œ -->
    <div th:if="${!post.postTags.isEmpty()}" class="article-tags">
        <a th:each="postTag : ${post.postTags}"
           th:href="@{/posts(keyword=${postTag.tagName})}"
           class="tag"
           th:text="'#' + ${postTag.tagName}">#ì œì£¼</a>
    </div>

    <!-- Author Controls (Edit/Delete) -->
    <div th:if="${#authentication != null and #authentication.name == post.author.username}"
         class="author-controls">
        <a th:href="@{/posts/{id}/edit(id=${post.id})}" class="btn-edit">ìˆ˜ì •</a>
        <form th:action="@{/posts/{id}/delete(id=${post.id})}" method="post" style="display: inline;">
            <button type="submit" class="btn-delete" onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì‚­ì œ</button>
        </form>
    </div>

    <!-- Featured Image -->
    <div th:if="${post.imageUrl != null and !post.imageUrl.isEmpty()}">
        <img th:src="@{/files/{filename}(filename=${post.imageUrl})}"
             alt="Article Image"
             class="featured-image">
    </div>

    <!-- Article Content -->
    <div class="article-content">
        <p th:utext="${post.content}">
            ì œì£¼ì—ì„œ í•œ ë‹¬ì„ ì§€ë‚´ë©° ëŠë‚€ ì ì€ 'ëŠë¦¼'ì˜ ì†Œì¤‘í•¨ì´ì—ˆìŠµë‹ˆë‹¤.
            ë§¤ì¼ ì•„ì¹¨ ë°”ë‹¤ë¥¼ ë³´ë©° ì‹œì‘í•˜ëŠ” í•˜ë£¨, ì—¬ìœ ë¡œìš´ ì‚°ì±…,
            ê·¸ë¦¬ê³  ë‚¯ì„  ì‚¬ëŒë“¤ê³¼ì˜ ë”°ëœ»í•œ ë§Œë‚¨ë“¤...
        </p>
    </div>

    <!-- Action Buttons -->
    <div class="article-actions">
        <button class="action-btn" id="likeBtn" th:classappend="${isLiked} ? 'active'" th:disabled="${#authentication == null}">
            <div class="action-icon">â¤ï¸</div>
            <div class="action-label">ì¢‹ì•„ìš”</div>
            <div class="action-count" id="likeCount" th:text="${likeCount}">0</div>
        </button>

        <button class="action-btn" id="bookmarkBtn" th:classappend="${isBookmarked} ? 'active'" th:disabled="${#authentication == null}">
            <div class="action-icon">ğŸ”–</div>
            <div class="action-label">ë¶ë§ˆí¬</div>
        </button>

        <button class="action-btn">
            <div class="action-icon">ğŸ’¬</div>
            <div class="action-label">ëŒ“ê¸€</div>
            <div class="action-count" id="commentCount">0</div>
        </button>
    </div>

    <!-- Share Section -->
    <div class="share-section">
        <div class="share-title">ì´ ê¸€ì„ ê³µìœ í•´ë³´ì„¸ìš”</div>
        <div class="share-buttons">
            <button class="share-btn" onclick="shareToFacebook()">ğŸ“˜</button>
            <button class="share-btn" onclick="shareToTwitter()">ğŸ¦</button>
            <button class="share-btn" onclick="copyLink()">ğŸ”—</button>
        </div>
    </div>

    <!-- Comments Section -->
    <section class="comments-section">
        <h2 class="comments-header">
            ëŒ“ê¸€ <span class="count" id="totalComments">0</span>
        </h2>

        <div th:if="${#authentication != null and #authentication.isAuthenticated()}" class="comment-form">
            <form id="commentForm">
                    <textarea
                            id="commentContent"
                            class="comment-textarea"
                            placeholder="ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”..."></textarea>
                <div class="comment-form-footer">
                    <button type="submit" class="btn-submit-comment">ëŒ“ê¸€ ì‘ì„±</button>
                </div>
            </form>
        </div>

        <div th:unless="${#authentication != null and #authentication.isAuthenticated()}"
             style="text-align: center; padding: 40px; background-color: #f8f9fa; border-radius: 12px; margin-bottom: 32px;">
            <p style="color: #666; margin-bottom: 16px;">ëŒ“ê¸€ì„ ì‘ì„±í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
            <a href="/auth/login" style="color: #2D9596; text-decoration: underline;">ë¡œê·¸ì¸í•˜ê¸°</a>
        </div>

        <div id="commentList" class="comments-list">
        </div>
    </section>
</article>

<!-- Footer -->
<footer>
    <!-- ... footer content ... -->
</footer>

<script th:inline="javascript">
    const postId = /*[[${post.id}]]*/ 0;
    const authorId = /*[[${post.author.id}]]*/ 0;
    const currentUsername = /*[[${#authentication != null ? #authentication.name : null}]]*/ null;

    async function loadComments() {
        try {
            const response = await fetch(`/api/comments/${postId}`);
            if (!response.ok) return;
            const comments = await response.json();
            const commentList = document.getElementById("commentList");
            commentList.innerHTML = "";
            document.getElementById("totalComments").textContent = comments.length;
            document.getElementById("commentCount").textContent = comments.length;
            comments.forEach(comment => {
                const commentItem = document.createElement("div");
                commentItem.className = "comment-item";
                const isAuthor = comment.username === currentUsername;
                commentItem.innerHTML = `
                    <div class="comment-header">
                        <div class="comment-author">
                            <div class="comment-avatar"></div>
                            <div>
                                <div class="comment-author-name">${comment.username}</div>
                                <div class="comment-date">${comment.createdAt}</div>
                            </div>
                        </div>
                        ${isAuthor ? `<button class="btn-delete-comment" onclick="deleteComment(${comment.id})">ì‚­ì œ</button>` : ''}
                    </div>
                    <div class="comment-content">${comment.content}</div>
                `;
                commentList.appendChild(commentItem);
            });
        } catch (error) {
            console.error('Failed to load comments:', error);
        }
    }

    const commentForm = document.getElementById("commentForm");
    if (commentForm) {
        commentForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const content = document.getElementById("commentContent").value.trim();
            if (!content) {
                alert('ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            try {
                await fetch(`/api/comments/${postId}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ postId, content, username: currentUsername }),
                });
                document.getElementById("commentContent").value = "";
                loadComments();
            } catch (error) {
                console.error('Failed to submit comment:', error);
                alert('ëŒ“ê¸€ ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        });
    }

    async function deleteComment(commentId) {
        if (!confirm('ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        try {
            await fetch(`/api/comments/${commentId}`, { method: "DELETE" });
            loadComments();
        } catch (error) {
            console.error('Failed to delete comment:', error);
            alert('ëŒ“ê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    }

    async function loadCounts() {
        try {
            const [followingRes, followerRes] = await Promise.all([
                fetch(`/api/follow/${authorId}/followingCount`),
                fetch(`/api/follow/${authorId}/followerCount`)
            ]);
            document.getElementById("followingCount").textContent = await followingRes.text();
            document.getElementById("followerCount").textContent = await followerRes.text();
        } catch (error) {
            console.error('Failed to load counts:', error);
        }
    }

    async function handleFollowToggle() {
        const button = document.getElementById("followToggleButton");
        if (!button) return;
        const isFollowing = button.getAttribute("data-following") === "true";
        try {
            await fetch(`/api/follow/${authorId}`, { method: isFollowing ? "DELETE" : "POST" });
            if (isFollowing) {
                button.classList.remove("following");
                button.textContent = "íŒ”ë¡œìš°";
                button.setAttribute("data-following", "false");
            } else {
                button.classList.add("following");
                button.textContent = "íŒ”ë¡œì‰";
                button.setAttribute("data-following", "true");
            }
            loadCounts();
        } catch (error) {
            console.error('Failed to handle follow:', error);
            alert('íŒ”ë¡œìš° ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    }

    const followToggleButton = document.getElementById("followToggleButton");
    if (followToggleButton) {
        followToggleButton.addEventListener("click", handleFollowToggle);
        followToggleButton.addEventListener("mouseenter", function() {
            if (this.getAttribute("data-following") === "true") this.textContent = "ì–¸íŒ”ë¡œìš°";
        });
        followToggleButton.addEventListener("mouseleave", function() {
            if (this.getAttribute("data-following") === "true") this.textContent = "íŒ”ë¡œì‰";
        });
    }

    const likeBtn = document.getElementById("likeBtn");
    if (likeBtn) {
        likeBtn.addEventListener("click", async function() {
            if (!currentUsername) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = '/auth/login';
                return;
            }
            try {
                const response = await fetch(`/api/posts/${postId}/like`, { method: "POST" });
                if (!response.ok) throw new Error('Server error');
                const data = await response.json();
                this.classList.toggle("active");
                document.getElementById("likeCount").textContent = data.likeCount;
            } catch (error) {
                console.error('Failed to toggle like:', error);
                alert('ì¢‹ì•„ìš” ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        });
    }

    const bookmarkBtn = document.getElementById("bookmarkBtn");
    if (bookmarkBtn) {
        bookmarkBtn.addEventListener("click", async function() {
            if (!currentUsername) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = '/auth/login';
                return;
            }
            try {
                const response = await fetch(`/api/posts/${postId}/bookmark`, { method: "POST" });
                if (!response.ok) throw new Error('Server error');
                this.classList.toggle("active");
            } catch (error) {
                console.error('Failed to toggle bookmark:', error);
                alert('ë¶ë§ˆí¬ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        });
    }

    function shareToFacebook() { window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}`, '_blank'); }
    function shareToTwitter() { window.open(`https://twitter.com/intent/tweet?url=${encodeURIComponent(window.location.href)}`, '_blank'); }
    function copyLink() { navigator.clipboard.writeText(window.location.href).then(() => alert('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!')); }

    document.addEventListener("DOMContentLoaded", () => {
        loadComments();
        if (document.getElementById("followingCount")) {
            loadCounts();
        }
    });
</script>
</body>
</html>
